<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Mudra Recognition App - Sign Up</title>
<link href="https://fonts.googleapis.com" rel="preconnect"/>
<link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/>
<link href="https://fonts.googleapis.com/css2?family=Epilogue:wght@400;500;600;700&display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<script src="https://cdn.tailwindcss.com?plugins=forms"></script>
<script>
tailwind.config = {
  darkMode: "class",
  theme: {
    extend: {
      colors: {
        "primary": "#9311d4",
        "background-light": "#f7f6f8",
        "background-dark": "#1c1022",
      },
      fontFamily: {
        "display": ["Epilogue", "sans-serif"]
      },
    },
  },
}
</script>
</head>
<body class="font-display bg-background-light dark:bg-background-dark text-gray-900 dark:text-gray-100 antialiased">

<div class="relative min-h-screen w-full flex items-center justify-center p-4">
  <div class="w-full max-w-md">
    <div class="bg-background-light dark:bg-background-dark/80 backdrop-blur-sm border border-primary/10 dark:border-primary/20 shadow-2xl shadow-primary/10 dark:shadow-primary/5 rounded-xl p-8 lg:p-10">
      <div class="text-center mb-8">
        <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Create an Account</h1>
        <p class="text-gray-500 dark:text-gray-400 mt-2">Join us and explore the world of Mudras.</p>
      </div>

      <!-- Sign Up Form -->
      <form id="signupForm" class="space-y-6">
  <!-- Full Name -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" for="full-name">Full Name</label>
    <input class="form-input mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary" id="full-name" name="full-name" type="text" placeholder="Enter your full name" required>
  </div>

  <!-- Email -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" for="email">Email</label>
    <input class="form-input mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary" id="email" name="email" type="email" placeholder="you@example.com" required>
  </div>

  <!-- Password -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" for="password">Password</label>
    <input class="form-input mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary" id="password" name="password" type="password" placeholder="••••••••" required>
    <p class="text-sm text-gray-500 mt-1">Min 8 chars, 1 uppercase, 1 number</p>
  </div>

  <!-- Confirm Password -->
  <div>
    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300" for="confirm-password">Confirm Password</label>
    <input class="form-input mt-1 block w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-700 placeholder-gray-400 dark:placeholder-gray-500 focus:outline-none focus:ring-primary focus:border-primary" id="confirm-password" name="confirm-password" type="password" placeholder="••••••••" required>
  </div>

  <!-- Create Account Button -->
  <div>
    <button type="submit" id="createAccountBtn" class="w-full flex justify-center py-3 px-4 rounded-lg text-white bg-primary hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary transition-all">
      Create Account
    </button>
  </div>

  <!-- Login Link -->
  <div class="text-center mt-4">
    <p class="text-sm text-gray-600 dark:text-gray-400">
      Already have an account?
      <a href="sign_in.html" class="font-medium text-primary hover:underline">Log in</a>
    </p>
  </div>
</form>


      <div id="feedback" class="mt-4 text-center text-sm text-red-600 dark:text-red-400"></div>
    </div>
  </div>
</div>

<script type="module">
import { auth, db } from './firebase-config.js';
import { createUserWithEmailAndPassword, updateProfile, sendEmailVerification } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js';
import { doc, setDoc } from 'https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js';

const form = document.getElementById('signupForm');
const feedback = document.getElementById('feedback');

form.addEventListener('submit', async (e) => {
  e.preventDefault();
  feedback.textContent = '';

  const fullName = document.getElementById('full-name').value.trim();
  const email = document.getElementById('email').value.trim();
  const password = document.getElementById('password').value;
  const confirm = document.getElementById('confirm-password').value;

  const passwordRegex = /^(?=.*[A-Z])(?=.*\d).{8,}$/;
  if (!passwordRegex.test(password)) {
    feedback.textContent = 'Password must be min 8 chars, 1 uppercase, 1 number.';
    return;
  }

  if (password !== confirm) {
    feedback.textContent = 'Passwords do not match.';
    return;
  }

  try {
    // Create user in Firebase Auth
    const userCredential = await createUserWithEmailAndPassword(auth, email, password);
    const user = userCredential.user;

    // Update display name
    await updateProfile(user, { displayName: fullName });

    // Save user to Firestore
    const userRef = doc(db, 'users', user.uid);
    await setDoc(userRef, {
      uid: user.uid,
      fullName,
      email,
      createdAt: new Date().toISOString()
    });

    // Send email verification
    await sendEmailVerification(user);

    // Feedback & redirect
    feedback.classList.remove('text-red-600');
    feedback.classList.add('text-green-600');
    feedback.textContent = 'Account created successfully! Verification email sent. Redirecting to login...';

    setTimeout(() => {
      window.location.href = 'sign_in.html';
    }, 2500);

  } catch(err) {
    console.error(err);
    feedback.textContent = err.code === 'auth/email-already-in-use'
      ? 'Email is already registered.'
      : err.message || 'Sign up failed';
  }
});
</script>

</body>
</html>
